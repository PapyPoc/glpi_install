#!/usr/bin/env bash
#
# GLPI install script
# Author: PapyPoc
# Version 1.8.0
# Variable file
#
set -euo pipefail
# Ne pas continuer si le script est exécuté directement
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    echo -e "Ce fichier doit être sourcé, pas exécuté.\n" >&2
    echo -e "This file must be sourced, not executed.\n" >&2
    exit 1
fi
# Determine the home directory of the user who invoked the installer (supports sudo).
if [ -n "${SUDO_USER:-}" ] && [ "${SUDO_USER}" != "root" ]; then
    INVOKING_USER="$SUDO_USER"
else
    INVOKING_USER="${LOGNAME:-${USER:-$(logname 2>/dev/null || echo root)}}"
fi
INVOKING_HOME=""
if command -v getent >/dev/null 2>&1; then
    INVOKING_HOME=$(getent passwd "$INVOKING_USER" | cut -d: -f6 || true)
else
    INVOKING_HOME="${INVOKING_HOME:-${HOME:-/root}}"
fi
if [ -z "$INVOKING_HOME" ]; then
    INVOKING_HOME=$(eval echo "~$INVOKING_USER" 2>/dev/null || true)
else
    INVOKING_HOME="${INVOKING_HOME:-${HOME:-/root}}"
    export INVOKING_HOME
fi
ROUGE='\033[0;31m' # Red
CYAN='\033[0;36m' # Cyan
NC='\033[0m' # No Color
DEBIAN_VERSIONS=("11" "12")
UBUNTU_VERSIONS=("23.10" "24.10")
ALMA_VERSIONS=("9.5")
CENTOS_VERSIONS=("9")
ROCKY_VERSIONS=("9.5")
REDHAT_VERSIONS=("9.5")
SQLROOTPWD=$(openssl rand -base64 48 | cut -c1-18)
SQLGLPIPWD=$(openssl rand -base64 48 | cut -c1-18)
ADMINGLPIPWD=$(openssl rand -base64 48 | cut -c1-12)
POSTGLPIPWD=$(openssl rand -base64 48 | cut -c1-12)
TECHGLPIPWD=$(openssl rand -base64 48 | cut -c1-12)
NORMGLPIPWD=$(openssl rand -base64 48 | cut -c1-12)
FICHIER_MSG="${INVOKING_HOME}/sauve_mdp.txt"
ERRORFILE="${INVOKING_HOME}/error.log"
LOGFILE="${INVOKING_HOME}/install.log"
export ROUGE CYAN NC
export DOWNLOADLINK NEW_VERSION
export DEBIAN_VERSIONS UBUNTU_VERSIONS ALMA_VERSIONS CENTOS_VERSIONS ROCKY_VERSIONS REDHAT_VERSIONS
export REP_BACKUP REP_GLPI
export SQLROOTPWD SQLGLPIPWD ADMINGLPIPWD POSTGLPIPWD TECHGLPIPWD NORMGLPIPWD
export DB_NAME DB_USER BDD_BACKUP
export FICHIER_MSG ERRORFILE LOGFILE