#!/usr/bin/env bash
#
# GLPI install script
# Author: PapyPoc
# Version: 1.8.0
# Main file
# Langage pris en compte français et anglais
#
set -Eeuo pipefail
clear # Nettoyer le terminal
REP_SCRIPT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" # Définir le répertoire du script
# shellcheck disable=SC1091
source "${REP_SCRIPT}/function" # Fichier de fonction
# shellcheck disable=SC1091
source "${REP_SCRIPT}/config" # Fichier de variable
load_language # Fichier de langue
# Regarde si la distribution est conforme
if ! check_distro; then
    dialog --title "Erreur" --msgbox "La vérification de la distribution a échoué." 6 50
    echo "Vérification de la distribution échouée" >> "${ERRORFILE}"
    exit 1
fi
# Demande les options d'installation
if ! prompt_install_options; then
    dialog --title "Annulation" --msgbox "L'installation a été annulée par l'utilisateur." 6 50
    echo "Prompt des options d'installation annulé ou échoué" >> "${ERRORFILE}"
    exit 1
fi
if ! check_install "${REP_GLPI}"; then
    dialog --title "Erreur" --msgbox "La vérification de l'installation a échoué ou l'utilisateur a annulé." 6 60
    echo "Vérification de l'installation échouée ou utilisateur a annulé" >> "${ERRORFILE}"
    exit 1
fi
display_result # Affiche le résultat de l'installation
chmod 600 "${FICHIER_MSG}"
chown root:root "${FICHIER_MSG}"
echo ""
warn "${MSG_FILE_MSG}"
echo ""