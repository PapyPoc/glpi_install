#!/usr/bin/env bash
#
# GLPI install script
# Author: PapyPoc
# Version: 1.8.0
# Main file
# Langage pris en compte français et anglais
#
set -Eeuo pipefail
clear # Nettoyer le terminal
REP_SCRIPT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" # Définir le répertoire du script
# shellcheck disable=SC1091
source "${REP_SCRIPT}/function" # Fichier de fonction
# shellcheck disable=SC1091
source "${REP_SCRIPT}/config" # Fichier de variable
load_language # Fichier de langue
trap 'on_error 2>> "${ERRORFILE}"' ERR

ls /fff
# Regarde si la distribution est conforme
if ! check_distro; then
    dialog --title "Erreur" --msgbox "La vérification de la distribution a échoué." 6 50
    echo "Vérification de la distribution échouée" >> "${ERRORFILE}"
    exit 1
fi
# Demande les options d'installation
if ! prompt_install_options; then
    dialog --title "Annulation" --msgbox "L'installation a été annulée par l'utilisateur." 6 50
    echo "Prompt des options d'installation annulé ou échoué" >> "${ERRORFILE}"
    exit 1
fi
if ! check_install "${REP_GLPI}"; then
    dialog --title "Erreur" --msgbox "La vérification de l'installation a échoué ou l'utilisateur a annulé." 6 60
    echo "Vérification de l'installation échouée ou utilisateur a annulé" >> "${ERRORFILE}"
    exit 1
fi
 # Affiche le résultat de l'installation
if ! display_result; then
    dialog --title "Erreur" --msgbox "L'affichage du résultat a échoué." 6 50
    echo "Affichage du résultat échoué" >> "${ERRORFILE}"
    exit 1
fi
if [ -f "${FICHIER_MSG}" ]; then
    chmod 600 "${FICHIER_MSG}"
    chown root:root "${FICHIER_MSG}"
    echo ""
    dialog --title "Information" --msgbox "Le fichier de sauvegarde ${FICHIER_MSG} a été créé avec succès." 6 60
    warn "${MSG_FILE_MSG}"
    echo ""
    echo "Fichier de sauvegarde : ${FICHIER_MSG}" >> "${LOGFILE}"
else
    echo ""
    dialog --title "Erreur" --msgbox "Le fichier de sauvegarde ${FICHIER_MSG} est introuvable." 6 60
    warn "${MSG_ERROR_INSTALL}"
    echo ""
    echo "Le fichier de sauvegarde ${FICHIER_MSG} est introuvable." >> "${ERRORFILE}"
fi
exit 0
# Fin du script